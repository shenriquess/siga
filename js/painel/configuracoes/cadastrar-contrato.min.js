$(document).ready(function(){var n=false;var d=0;var j=true;var w=true;var s=0;var f=0;p();$("#botaoAdicionar").click(function(){if(!e()){if(w==true){$("#listaVazia").hide()}if(n==false){z();s++;notificacao_sucesso("Item <b>adicionado</b> com sucesso.");g()}else{n=false;q();$("#botaoAdicionar").attr("class","btn btn-default btn-block");$("#botaoAdicionar").html("Adicionar a Lista");notificacao_sucesso("Item <b>editado</b> com sucesso.");g()}p()}});$("#botaoCadastrarContrato").click(function(){if(!h()){G();if(j==false){D()}$("#myModal").modal("show")}});$("#confBotaoEnviar").click(function(){$("#barraProgresso").show();$("#modalTitulo").html("Realizando Cadastro");x()});$("#formCodigo").focusout(C);$("#formItem").change(o);$("#formTipo").change(function(){$("#formItem").empty();$("#formItem").html(F($("#formTipo option:selected").val()))});y();A();function z(){var J=$("#formItem option:selected");var L=$("#formQuantidade");var I=$("#formTipo option:selected");var K=$("#formUnidade");var N=$("#formPreco");var M='<div class="listaItem"><div class="row"><var class="idTipo" style="display: none">'+I.val()+'</var><var class="idItem" style="display: none">'+J.val()+'</var><var class="valorQuantidade" style="display: none">'+L.val()+'</var><var class="valorPreco" style="display: none">'+N.val()+'</var><div class="col-md-3 tipo" style="margin-top: 5px">'+I.text()+'</div><div class="col-md-3 item" style="margin-top: 5px">'+J.text()+'</div><div class="col-md-2 quantidade" style="margin-top: 5px">'+L.val()+" "+K.html()+'</div><div class="col-md-2 preco" style="margin-top: 5px">R$ '+parseFloat(N.val()).toFixed(2)+'</div><div class="col-md-2"><div class="text-right"><button class="btn btn-default botaoEditar"><i class="fa fa-edit"></i></button><button class="btn btn-danger botaoRemover"><i class="fa fa-trash"></i></button></div></div></div><hr/></div>';$("#listaItens").append(M)}function y(){$("#dataInicio").datepicker({format:"dd/mm/yyyy",todayBtn:"linked",language:"pt-BR",autoclose:true,todayHighlight:true});$("#dataFim").datepicker({format:"dd/mm/yyyy",todayBtn:"linked",language:"pt-BR",autoclose:true,todayHighlight:true})}function A(){$("#formFornecedor").off()}function F(K){var J=$("#formItem");var I='<option value="0">Item</option>';for(var L in itens){if(itens.hasOwnProperty(L)!=null&&itens[L].id_tipo==K){I+='<option value="'+itens[L].id_item+'">'+itens[L].nome+"</option>"}}J.empty();J.html(I)}function o(){var J=$("#formItem option:selected").val();var K=false;for(var I in itens){if(itens.hasOwnProperty(I)&&itens[I]["id_item"]==J){$("#formUnidade").html(unidades[itens[I]["unidade_padrao_id"]]["nome"]);K=true;break}}if(!K){$("#formUnidade").empty()}}function i(){$("#dataInicio").datepicker("remove");$("#dataFim").datepicker("remove")}function c(){var I;$("#formFornecedor").focus(function(){I=$(this).val()}).change(function(){$(this).val(I)})}function q(){var I=$("#formTipo option:selected");var M=$("#formItem option:selected");var K=$("#formQuantidade");var J=$("#formUnidade");var L=$("#formPreco");$($(".idTipo")[f]).html(I.val());$($(".idItem")[f]).html(M.val());$($(".valorQuantidade")[f]).html(K.val());$($(".valorPreco")[f]).html(L.val());$($(".tipo")[f]).html(I.text());$($(".item")[f]).html(M.text());$($(".quantidade")[f]).html(K.val()+" "+J.html());$($(".preco")[f]).html("R$ "+L.val())}function x(){var J=$("#formFornecedor option:selected").val();var L=$("#formCodigo").val();var I=$("#formDataInicio").val();var K=$("#formDataFim").val();var M=[];$('var[class="idTipo"]').each(function(O,N){if(!M.hasOwnProperty(O)){M[O]={idFornecedor:J,codigo:L,dataInicio:I,dataFim:K}}M[O][$(this).attr("class")]=$(this).html()});$('var[class="idItem"]').each(function(O,N){if(!M.hasOwnProperty(O)){M[O]={idFornecedor:J,codigo:L,dataInicio:I,dataFim:K}}M[O][$(this).attr("class")]=$(this).html()});$('var[class="valorQuantidade"]').each(function(O,N){if(!M.hasOwnProperty(O)){M[O]={idFornecedor:J,codigo:L,dataInicio:I,dataFim:K}}M[O][$(this).attr("class")]=$(this).html()});$('var[class="valorPreco"]').each(function(O,N){if(!M.hasOwnProperty(O)){M[O]={idFornecedor:J,codigo:L,dataInicio:I,dataFim:K}}M[O][$(this).attr("class")]=$(this).html()});if(j==true){$.ajax({url:urlBase+"api/painel/configuracoes/cadastrarcontrato/cadastrar",type:"post",dataType:"json",data:JSON.stringify(M),success:function(O,N){b()},error:function(P,O,N){v()}})}else{$.ajax({url:urlBase+"api/painel/configuracoes/cadastrarcontrato/adicionar",type:"post",dataType:"json",data:JSON.stringify(M),success:function(O,N){b()},error:function(P,O,N){v()}})}}function r(){$("#formFornecedor").val(0);$("#formCodigo").val("");$("#formDataInicio").val("");$("#formDataFim").val("")}function g(){$("#formTipo").val(0);$("#formItem").val(0);$("#formQuantidade").val("");$("#formUnidade").empty();$("#formPreco").val("")}function m(){$("#listaItens").empty();$("#listaVazia").show();s=0;w=true}function E(){$("#listaCadastrada").empty();$("#listaCadastradaColunas").hide();$("#alertaCodigoCadastrado").hide();d=0;j=true}function H(){r();g();m();E()}function l(){$("#modalAvisoCodigo").modal("show")}function v(){$("#tituloModal").html("Confirmação de Cadastro de Contrato");$("#barraProgresso").hide();$("#modalErro").modal("show")}function b(){var I='<div class="row"><div class="col-md-12"><div class="text-center"><h4>Contrato cadastrado com <b>sucesso</b>.</h4></div></div></div><div class="row"><div class="col-md-2 col-md-offset-5"><button id="botaoOk" class="btn btn-success btn-block">OK</button></div></div>';$("#modalRodape").empty();$("#modalTitulo").html("Contrato Cadastrado");$("#modalCorpo").html(I);$("#botaoOk").click(function(){location.reload();H()})}function k(J){var O=$("#listaCadastrada");var N=$("#listaCadastradaColunas");var M=$("#alertaCodigoCadastrado");N.show();M.show();j=false;var K=false;for(var I in J){if(J.hasOwnProperty(I)){if(!K){a(J[I].id_fornecedor,J[I].data_inicio,J[I].data_fim);K=true}var L='<div class="listaItemCadastrada"><div class="row"><var class="idTipoCadastrado" style="display: none">'+J[I].id_tipo+'</var><var class="idItemCadastrado" style="display: none">'+J[I].id_item+'</var><var class="valorQuantidadeCadastrado" style="display: none">'+J[I].quantidade+'</var><var class="valorPrecoCadastrado" style="display: none">'+J[I].valor+'</var><div class="col-md-4 tipoCadastrado" style="margin-top: 5px">'+J[I].nome_tipo+'</div><div class="col-md-3 itemCadastrado" style="margin-top: 5px">'+J[I].nome_item+'</div><div class="col-md-3 quantidadeCadastrado" style="margin-top: 5px">'+J[I].quantidade+" "+unidades[J[I].unidade_padrao_id]["nome"]+'</div><div class="col-md-2 precoCadastrado" style="margin-top: 5px">R$ '+parseFloat(J[I].valor).toFixed(2)+"</div></div><hr/></div>";d++;O.append(L)}}u()}function G(){var L="";var K=$(".tipo");var M=$(".item");var J=$(".quantidade");var I=$(".preco");$("#confFormFornecedor").text($("#formFornecedor option:selected").text());$("#confFormCodigo").text($("#formCodigo").val());$("#confFormDataInicio").text($("#formDataInicio").val());$("#confFormDataFim").text($("#formDataFim").val());$("#confValorTotal").text($("#valorTotal").text());$(".listaItem").each(function(O,N){L+='<div class="row"><div class="col-md-3" style="padding-right: 0;"><h5>'+$(K[O]).html()+'</h5></div><div class="col-md-3" style="padding-right: 0; padding-left: 4px;"><h5>'+$(M[O]).html()+'</h5></div><div class="col-md-3" style="padding-right: 0; padding-left: 4px;"><h5>'+$(J[O]).html()+'</h5></div><div class="col-md-3" style="padding-right: 0; padding-left: 4px;"><h5>'+$(I[O]).html()+"</h5></div></div>"});$("#confListaItem").html(L)}function D(){var K="";var I=$(".tipoCadastrado");var O=$(".itemCadastrado");var P=$(".quantidadeCadastrado");var N=$(".precoCadastrado");var M=$(".listaItemCadastrada");var L=$("#confListaCadastrada");var J=$("#confListaCadastradaColunas");J.show();M.each(function(Q,R){K+='<div class="row"><div class="col-md-3" style="padding-right: 0;"><h5>'+$(I[Q]).html()+'</h5></div><div class="col-md-3" style="padding-right: 0; padding-left: 4px;"><h5>'+$(O[Q]).html()+'</h5></div><div class="col-md-3" style="padding-right: 0; padding-left: 4px;"><h5>'+$(P[Q]).html()+'</h5></div><div class="col-md-3" style="padding-right: 0; padding-left: 4px;"><h5>'+$(N[Q]).html()+"</h5></div></div>"});L.html(K)}function B(){var I=$(".botaoEditar");I.off();I.each(function(J,K){$(K).click(function(){var M=$($(".idTipo")[J]);var N=$($(".idItem")[J]);var L=$($(".valorQuantidade")[J]);var O=$($(".valorPreco")[J]);f=J;n=true;$("#formTipo").val(M.html());F(M.html());$("#formItem").val(N.html());$("#formQuantidade").val(L.html());o();$("#formPreco").val(O.html());$("#botaoAdicionar").attr("class","btn btn-warning btn-block");$("#botaoAdicionar").html("Edição Concluída")})})}function t(){var I=$(".botaoRemover");I.off();I.each(function(K,J){$(J).click(function(){$($(".listaItem")[K]).remove();s--;p();if(s==0){$("#listaVazia").show()}notificacao_sucesso("Item <b>removido</b> com sucesso.")})})}function u(){var J=0;var M=$('var[class="valorPreco"]');var I=$('var[class="valorQuantidade"]');$(".listaItem").each(function(O,N){J+=(parseFloat($(M[O]).html())*parseInt($(I[O]).html()))});var K=$('var[class="valorPrecoCadastrado"]');var L=$('var[class="valorQuantidadeCadastrado"]');$(".listaItemCadastrada").each(function(N,O){J+=(parseFloat($(K[N]).html())*parseInt($(L[N]).html()))});$("#valorTotal").html("R$ "+parseFloat(J).toFixed(2))}function p(){B();t();u()}function a(J,K,I){$("#formFornecedor").val(J);$("#formDataInicio").val(K);$("#formDataFim").val(I)}function e(){var L=false;var I=$("#formTipo option:selected");var N=$("#formItem option:selected");var K=$("#formQuantidade");var M=$("#formPreco");if(contarLetra(M.val(),",")==1){var J=M.val();M.val(J.replace(/,/g,"."))}M.val(parseFloat(M.val()).toFixed(2));if(I.val()<=0){L=true;notificacao_alerta("Selecine um <b>Tipo</b>.")}else{if(N.val()<=0){L=true;notificacao_alerta("Selecine um <b>Item</b.")}else{if(K.val().indexOf(".")>0||K.val().indexOf(",")>0){L=true;notificacao_alerta("Insira apenas valores inteiros em <b>Quantidade</b>.")}else{if(!$.isNumeric(K.val())){L=true;notificacao_alerta("Insira um número em <b>Quantidade</b>.")}else{if(K.val()<=0){L=true;notificacao_alerta("Insira um valor maior que 0 (zero) em <b>Quantidade</b>.")}else{if(!$.isNumeric(M.val())){L=true;notificacao_alerta("Insira um número em <b>Valor</b>.")}else{if(M.val()<=0){L=true;notificacao_alerta("Insira um valor maior que 0 (zero) em <b>Valor</b>.")}else{$('var[class="idItem"]').each(function(O,P){if($(P).html()==N.val()&&n==false){L=true;notificacao_alerta("<b>Itens iguais</b> estão sendo cadastrados. Junte suas quantidades.")}});if(j==false){$('var[class="idItemCadastrado"]').each(function(P,O){if($(O).html()==N.val()&&n==false){L=true;notificacao_alerta("Este <b>Item</b> já foi cadastrado para esse contrato.</b>")}})}}}}}}}}return L}function h(){var K=false;if($("#formFornecedor option:selected").val()<=0){K=true;notificacao_alerta("Selecione um <b>Fornecedor</b>.")}else{if($.trim($("#formCodigo").val())==""){K=true;notificacao_alerta("Insira um <b>Código</b>.")}else{if($.trim($("#formDataInicio").val())==""){K=true;notificacao_alerta("Insira uma <b>Data Saída</b>.")}else{if($.trim($("#formDataFim").val())==""){K=true;notificacao_alerta("Insira uma <b>Data Fim</b>.")}else{if(pegaData($("#formDataInicio").val())>=pegaData($("#formDataFim").val())){K=true;notificacao_alerta("A <b>Data Início</b> não pode ser maior ou igual que a <b>Data Fim</b>.")}else{if(s<=0){K=true;notificacao_alerta("<b>Lista de Itens</b> está vazia.")}else{if(j==true){var I=$("#formCodigo");for(var J in contratos){if(contratos.hasOwnProperty(J)&&I.val()==contratos[J]["codigo"]){K=true;notificacao_alerta("Já existe um <b>contrato</b> com o mesmo código inserido.");break}}}}}}}}}return K}function C(){var I=$("#formCodigo");if($.trim(I.val())!=""){$.ajax({url:urlBase+"api/painel/configuracoes/cadastrarcontrato/lerdadoscontrato",type:"get",dataType:"json",data:"formCodigo="+I.val(),success:function(K,J){if(K.sucesso==true){E();i();c();k(K.resposta);u()}else{E();y();A();u()}},error:function(L,K,J){}})}}});