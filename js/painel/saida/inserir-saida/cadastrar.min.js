$(document).ready(function(){var a=!1,t=0,o=0;function e(a){var t=$("#formItem"),o='<option value="0">Item</option>';for(var i in itens)null!=itens.hasOwnProperty(i)&&itens[i].id_tipo==a&&(o+='<option value="'+itens[i].id_item+'">'+itens[i].nome+"</option>");t.empty(),t.html(o)}function n(a){var t=$("#formContrato"),o='<option value="0">Contrato</option>';for(var i in contratos)null!=contratos.hasOwnProperty(i)&&contratos[i].id_item==a&&(o+='<option value="'+contratos[i].id_item_contrato+'">'+contratos[i].codigo+"</option>");t.empty(),t.html(o)}function s(){var a=$("#formItem option:selected").val(),t=!1;for(i in itens)if(itens.hasOwnProperty(i)&&itens[i].id_item==a){$("#formUnidade").html(unidades[itens[i].unidade_padrao_id].nome),t=!0;break}t||$("#formUnidade").empty()}function r(){$("#formTipo").val(0),$("#formItem").val(0),$("#formContrato").val(0),$("#formQuantidade").val(""),$("#formUnidade").empty()}function d(){$("#tituloModal").html("Confirmação de Cadastro de Saída"),$("#barraProgresso").hide(),$("#modalErro").modal("show")}function l(){var i,r;(i=$(".botaoEditar")).off(),i.each(function(t,i){$(i).click(function(){var i=$($(".idTipo")[t]),r=$($(".idItem")[t]),d=$($(".idContrato")[t]),l=$($(".valorQuantidade")[t]);o=t,a=!0,$("#formTipo").val(i.html()),e(i.html()),$("#formItem").val(r.html()),n(r.html()),$("#formContrato").val(d.html()),$("#formQuantidade").val(l.html()),s(),$("#botaoAdicionar").attr("class","btn btn-warning btn-block"),$("#botaoAdicionar").html("Edição Concluída")})}),(r=$(".botaoRemover")).off(),r.each(function(a,o){$(o).click(function(){$($(".listaItem")[a]).remove(),t--,l(),0==t&&$("#listaVazia").show(),notificacao_sucesso("Item <b>removido</b> com sucesso.")})})}function c(){var a=!1,t=$('var[class="idItem"]'),o=$('var[class="valorQuantidade"]');return $.ajax({url:urlBase+"api/painel/saida/inserirsaida/itens",async:!1,type:"get",dataType:"json",success:function(a,t){1==a.sucesso&&(itens=a.resposta)},error:function(a,t,o){d()}}),t.each(function(t,i){for(var e in itens)if(itens.hasOwnProperty(e)&&itens[e].id_item==$(i).html()&&parseInt($(o[t]).html())>parseInt(itens[e].quantidade_total))return a=!0,notificacao_alerta("Não há <b>Quantidade</b> disponível de <b>"+itens[e].nome+"</b>."),notificacao_sucesso("Quantidade de <b>"+itens[e].nome+"</b> disponível: "+itens[e].quantidade_total+" "+unidades[itens[e].unidade_padrao_id].nome),!1}),a}l(),$("#botaoAdicionar").click(function(){var i,e,n,s,d,c,m,f,u,v,p;(function(){var t=!1,o=$("#formTipo option:selected"),i=$("#formItem option:selected"),e=$("#formContrato option:selected"),n=$("#formQuantidade");if(o.val()<=0)t=!0,notificacao_alerta("Selecine um <b>Tipo</b>.");else if(i.val()<=0)t=!0,notificacao_alerta("Selecine um <b>Item</b.");else if(e.val()<=0)t=!0,notificacao_alerta("Selecine um <b>Contrato</b.");else if($.isNumeric(n.val()))if(n.val().indexOf(".")>0||n.val().indexOf(",")>0)t=!0,notificacao_alerta("Insira apenas valores inteiros em <b>Quantidade</b>.");else if(n.val()<=0)t=!0,notificacao_alerta("Insira um valor maior que 0 (zero) em <b>Quantidade</b>.");else{for(var s in itens)if(itens.hasOwnProperty(s)&&itens[s].id_item==i.val()&&parseInt(itens[s].quantidade_total)<parseInt(n.val())){t=!0,notificacao_alerta("Não há <b>Quantidade</b> disponível de <b>"+itens[s].nome+"</b>."),notificacao_sucesso("Quantidade de <b>"+itens[s].nome+"</b> disponível: "+itens[s].quantidade_total+" "+unidades[itens[s].unidade_padrao_id].nome);break}$('var[class="idItem"]').each(function(o,e){$(e).html()==i.val()&&0==a&&(t=!0,notificacao_alerta("<b>Itens iguais</b> estão sendo cadastrados. Junte suas quantidades."))})}else t=!0,notificacao_alerta("Insira um número em <b>Quantidade</b>.");return t})()||($("#listaVazia").hide(),0==a?(c=$("#formItem option:selected"),m=$("#formContrato option:selected"),f=$("#formQuantidade"),u=$("#formTipo option:selected"),v=$("#formUnidade"),p='<div class="listaItem"><div class="row"><var class="idTipo" style="display: none">'+u.val()+'</var><var class="idItem" style="display: none">'+c.val()+'</var><var class="idContrato" style="display: none">'+m.val()+'</var><var class="valorQuantidade" style="display: none">'+f.val()+'</var><div class="col-md-2 tipo" style="margin-top: 5px">'+u.text()+'</div><div class="col-md-3 item" style="margin-top: 5px">'+c.text()+'</div><div class="col-md-2 contrato" style="margin-top: 5px">'+m.text()+'</div><div class="col-md-2 quantidade" style="margin-top: 5px">'+f.val()+" "+v.html()+'</div><div class="col-md-3"><div class="text-right"><button class="btn btn-default botaoEditar"><i class="fa fa-edit"></i></button><button class="btn btn-danger botaoRemover"><i class="fa fa-trash"></i></button></div></div></div><hr/></div>',$("#listaItens").append(p),t++,notificacao_sucesso("Item <b>adicionado</b> com sucesso."),r()):(a=!1,i=$("#formTipo option:selected"),e=$("#formItem option:selected"),n=$("#formContrato option:selected"),s=$("#formQuantidade"),d=$("#formUnidade"),$($(".idTipo")[o]).html(i.val()),$($(".idItem")[o]).html(e.val()),$($(".idContrato")[o]).html(n.val()),$($(".valorQuantidade")[o]).html(s.val()),$($(".tipo")[o]).html(i.text()),$($(".item")[o]).html(e.text()),$($(".contrato")[o]).html(e.text()),$($(".quantidade")[o]).html(s.val()+" "+d.html()),$("#botaoAdicionar").attr("class","btn btn-default btn-block"),$("#botaoAdicionar").html("Adicionar a Lista"),notificacao_sucesso("Item <b>editado</b> com sucesso."),r()),l())}),$("#botaoInserirSaida").click(function(){var a,o,i,e;(function(){var a=!1;$("#formDestino option:selected").val()<=0?(a=!0,notificacao_alerta("Selecione um <b>Destino</b>.")):""==$.trim($("#formDataSaida").val())?(a=!0,notificacao_alerta("Insira uma <b>Data Saída</b>.")):pegaData($("#formDataSaida").val())>new Date?(a=!0,notificacao_alerta("A <b>Data Saída</b> não pode ser maior que a data atual.")):t<=0&&(a=!0,notificacao_alerta("<b>Lista de Itens</b> está vazia."));return a})()||c()||(a="",o=$(".tipo"),i=$(".item"),e=$(".quantidade"),$("#confFormDestino").text($("#formDestino option:selected").text()),$("#confFormDataSaida").text($("#formDataSaida").val()),$(".listaItem").each(function(t,n){a+='<div class="row"><div class="col-md-4" style="padding-right: 0;"><h5 id="confFormTipo">'+$(o[t]).html()+'</h5></div><div class="col-md-4" style="padding-right: 0; padding-left: 4px;"><h5 id="confFormItem">'+$(i[t]).html()+'</h5></div><div class="col-md-4" style="padding-right: 0; padding-left: 4px;"><h5 id="confFormQuantidade">'+$(e[t]).html()+"</h5></div></div>"}),$("#confListaItem").html(a),$("#myModal").modal("show"))}),$("#confBotaoEnviar").click(function(){var a,t,o;c()||($("#barraProgresso").show(),$("#tituloModal").html("Realizando Cadastro."),a=$("#formDestino").val(),t=$("#formDataSaida").val(),o=[],$('var[class="idTipo"]').each(function(i,e){o.hasOwnProperty(i)||(o[i]={idDestino:a,dataSaida:t}),o[i][$(this).attr("class")]=$(this).html()}),$('var[class="idItem"]').each(function(i,e){o.hasOwnProperty(i)||(o[i]={idDestino:a,dataSaida:t}),o[i][$(this).attr("class")]=$(this).html()}),$('var[class="idContrato"]').each(function(i,e){o.hasOwnProperty(i)||(o[i]={idDestino:a,dataSaida:t}),o[i][$(this).attr("class")]=$(this).html()}),$('var[class="valorQuantidade"]').each(function(i,e){o.hasOwnProperty(i)||(o[i]={idDestino:a,dataSaida:t}),o[i][$(this).attr("class")]=$(this).html()}),$.ajax({url:urlBase+"api/painel/saida/inserirsaida/cadastrar",type:"post",dataType:"json",data:JSON.stringify(o),success:function(a,t){1==a.sucesso&&($("#formGerarSaida").val(JSON.stringify(a.resposta)),$("#gerarSaida").submit())},error:function(a,t,o){d()}}))}),$("#formItem").change(s),$("#formItem").change(function(){$("#formContrato").empty(),$("#formContrato").html(n($("#formItem option:selected").val()))}),$("#formTipo").change(function(){$("#formItem").empty(),$("#formContrato").empty(),$("#formContrato").html('<option value="0">Contrato</option>'),$("#formItem").html(e($("#formTipo option:selected").val()))}),$("#dataSaida").datepicker({format:"dd/mm/yyyy",todayBtn:"linked",language:"pt-BR",autoclose:!0,todayHighlight:!0})});
